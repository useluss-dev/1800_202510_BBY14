import{o as R}from"./userLoggedIn-BiC4FiBi.js";import{d as N,f}from"./index-vPvsWSrS.js";const B=new URLSearchParams(window.location.search),x=N.collection("users"),w=N.collection("landlords"),u=B.get("landlord"),C=document.getElementById("landlordExists"),y=document.getElementById("landlordNull"),S=N.collection("reviews"),L=document.forms.review,E={starImageActive:"/assets/StarIconActive.svg",starImageNone:"/assets/StarIcon.svg"};function k(e){const n=e.appendChild(document.createElement("label"));return{label:n,input:n.appendChild(document.createElement("input")),span:n.appendChild(document.createElement("span"))}}function F(e){const n=e.appendChild(document.createElement("label"));return{label:n,image:n.appendChild(document.createElement("img")),input:n.appendChild(document.createElement("input"))}}function U(e,n,t){const a=k(n),{label:r,input:i,span:s}=a;r.id=e+"ClearLabel",i.type="radio",i.checked=!0,i.id=e+"Clear",i.name=e,i.value=0,s.textContent="Clear",t(a)}function q(e,n,t){for(let a=1;a<=5;a++){const r=F(n);r.label.id=e+"Label"+a,r.image.id=e+"Image"+a,r.input.type="radio",r.input.id=e+a,r.input.name=e,r.input.value=a,t(r)}}function h(e,n,t={}){const a={fieldDiv:"flex justify-between items-center",starDiv:"flex",clearLabel:"px-2 py-1 border-2 hover:border-black hover:bg-black hover:text-white transition",clearInput:"hidden",clearSpan:"",starLabel:"not-last:pr-2",starImage:"h-10",starInput:"hidden"},r=document.getElementById(e+"Field"),i=r.appendChild(document.createElement("div"));r.className=t.fieldset?t.fieldset:a.fieldDiv,i.className=t.starDiv?t.starDiv:a.starDiv,q(e,i,({label:s,image:l,input:o})=>{s.className=t.starLabel?t.starLabel:a.starLabel,l.src=E.starImageNone,l.className=t.starImage?t.starImage:a.starImage,o.className=t.starInput?t.starInput:a.starInput,o.addEventListener("change",c=>{I(e,o.value)})}),U(e,r,({label:s,input:l,span:o})=>{s.className=t.clearLabel?t.clearLabel:a.clearLabel,l.className=t.clearInput?t.clearInput:a.clearInput,o.className=t.clearSpan?t.clearSpan:a.clearSpan,l.addEventListener("change",c=>{I(e,l.value)})}),I(e,0)}function I(e,n){const t=document.getElementsByName(e);for(const a of t)if(a.value==0){const r=document.getElementById(e+"ClearLabel");a.value==n?r.classList.add("opacity-0"):r.classList.remove("opacity-0")}else{const r=document.getElementById(e+"Image"+a.value);r.src=a.value<=n?E.starImageActive:E.starImageNone}}function A(){C.classList.remove("hidden"),y.classList.add("hidden")}function b(){C.classList.add("hidden"),y.classList.remove("hidden")}function P(e){const n=document.getElementById("firstName"),t=document.getElementById("lastName");n.textContent=e.firstName,t.textContent=e.lastName}function V(){if(u){w.doc(u).get().then(e=>{e.exists?(P(e.data()),A()):b()}).catch(e=>{b()});return}b()}function T(){const e=new FormData(L);for(const n of e){const[t,a]=n;switch(t){case"behavior":case"rules":case"quality":case"rent":if(a==0)return!1;break;case"content":case"title":if(a.length==0)return!1;break}}return!0}L.addEventListener("submit",e=>{e.preventDefault();const n=new FormData(L);if(!T()){document.getElementById("requiredError").classList.remove("opacity-0");return}const t={behavior:parseInt(n.get("behavior"),10),rules:parseInt(n.get("rules"),10),quality:parseInt(n.get("quality"),10),rent:parseInt(n.get("rent"),10)};let a=0;for(let l in t)a+=t[l];t.overall=a/4,console.log(t);const i=n.get("tags").split(",").map(l=>l.trim());console.log(i);const s={createdAt:f.firestore.Timestamp.now(),title:n.get("title"),content:n.get("content"),tags:i,ratings:t,landlordId:u};S.add(s).then(l=>{const o=l.id,c=w.doc(u),m=f.auth().currentUser,v=x.doc(m.uid),d=c.update({reviews:f.firestore.FieldValue.arrayUnion(o)}),p=v.update({reviews:f.firestore.FieldValue.arrayUnion(o)});return Promise.all([d,p]).then(()=>o)}).then(l=>S.where("landlordId","==",u).get()).then(l=>{let o=0,c=0,m=0,v=0;const d=l.size;l.forEach(D=>{const g=D.data().ratings;o+=g.behavior,c+=g.quality,m+=g.rules,v+=g.rent});const p={behavior:o/d,quality:c/d,rules:m/d,rent:v/d,overall:(o+c+v+m)/(4*d)};w.doc(u).update({ratings:p})}).then(()=>{console.log("Review ID added to both landlord and user documents."),window.location.href=`/landlord/${u}`}).catch(l=>{console.error("Error adding review or updating documents:",l)})});R(e=>{V(),h("behavior"),h("rules"),h("quality"),h("rent")},()=>{window.location.href="/login"});
